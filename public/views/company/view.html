<div class="" id="viewModal">

  <div ng-hide="company">
    <h1>Loading...</h1>
  </div>

  <div ng-show="company">
    <div class="ink-grid">
      <div class="column-group horizontal-gutters">
        <div class="all-100">
          <h1>{{company.name}}</h1>
        </div>
      </div>

      <div class="column-group horizontal-gutters">
        <div class="all-30 medium-30 small-100 tiny-100">
          <p class="button-group">
            <a class="ink-button orange" href="#/company/{{company.id}}/edit"><i class="fa fa-wrench"></i> Edit Company</a>
            <a class="ink-button red" ng-if="checkPermission()" ng-click="deleteCompany(company)"><i class="fa fa-times"></i> Delete Company</a>
            <subscription thread="{{'company-' + company.id}}"></subscription>
          </p>
          <img ng-show="company.img" ng-src="{{company.img}}" width="100%" />
          <br><br>
          <b>Area: </b><div ng-bind-html="company.area"></div><br>
          <b>Description: </b><div ng-if="company.description" ng-bind-html="convertURLs(company.description)"></div>
          <br>
        </div>
        <div class="all-40 medium-40 small-100 tiny-100">
          <div ng-if="company.history">
            <h3>History</h3>
            <div ng-bind-html="convertURLs(company.history)"></div>
          </div>
          <br>
          <div ng-if="company.contacts">
            <h3>Contacts</h3>
            <div ng-bind-html="convertEmails(convertURLs(company.contacts))"></div>
          </div>
          <br>
          <div ng-if="company.accesses">
            <h3>Acesses</h3>
            <ul>
              <li ng-repeat="access in company.accesses">Someone accessed {{access.where}} {{timeSince(access.date)}}.</li>
            </ul>
          </div>
          <br>
          <div ng-if="companyNotifications">
            <h3>Last Changes</h3>
            <ul class="unstyled">
              <li ng-repeat="notification in companyNotifications | orderBy: 'posted':true | limitTo: 10">
                <a href="#/member/{{notification.member}}" title="{{getMember(notification.member).name}}">
                  <img ng-src="https://graph.facebook.com/{{getMember(notification.member).facebook}}/picture" style="width:25px"/>
                </a>
                {{notification.description}} <small>{{timeSince(notification.posted)}}</small>.
              </li>
            </ul>
          </div>
        </div>
        <div class="all-30 medium-30 small-100 tiny-100">
          <div class="all-60"><h3>Participations</h3></div>
          <div class="all-40"><a class="ink-button orange push-right" href="#/company/{{company.id}}/participations"><i class="fa fa-wrench"></i> Edit</a></div>
          <div class="all-100"><h6 ng-if="!company.participations[0]">No participations to date</h6></div>
          <div class="card" ng-repeat="participation in company.participations">
            <div class="content full">
              <h5>
                {{getEvent(participation.event).name}} 
                <span class="status" ng-class="participation.status.replace(' ','-').toLowerCase()">{{participation.status}}</span>
              </h5>
              <h6 ng-if="participation.member">
                <a href="#/member/{{participation.member}}">
                <img ng-if="participation.member" ng-src="https://graph.facebook.com/{{getMember(participation.member).facebook}}/picture"/>
                <b> {{getMember(participation.member).name}}</b>
                </a>
              </h6>
              <h6>{{participation.kind}}</h6>
              <div class="small" ng-if="participation.payment">
                <span ng-if="participation.payment.price"><b>Price: </b>{{participation.payment.price}}€<br></span>
                <span ng-if="participation.payment.total"><b>Total: </b>{{participation.payment.total}}€ (incl. IVA)<br></span>
                <span ng-if="participation.payment.invoice"><b>Invoice: </b>{{participation.payment.invoice}}<br></span>
                <span ng-if="participation.payment.date"><b>Date: </b>{{participation.payment.date}}<br></span>
                <span ng-if="participation.payment.status"><b>Status: </b>{{participation.payment.status}}<br></span>
                <span ng-if="participation.payment.via"><b>Via: </b>{{participation.payment.via}}<br></span>
              </div>
              <br>
              <div class="small" ng-if="participation.items[0]">
                <b>Items</b><br>
                <div ng-repeat="item in participation.items">
                  <span ng-if="item.amount"><b>{{item.amount}}</b></span>
                  {{getItem(item.id).name}} 
                  <span ng-if="item.kind"> - <b>{{item.kind}}</b></span> 
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <h2 ng-click="hideCommunications=!hideCommunications" title="Click to show/hide communications"> 
        Communications 
        <i ng-show="hideCommunications" class="fa fa-chevron-circle-down" style="font-size:30px"></i> 
        <i ng-hide="hideCommunications" class="fa fa-chevron-circle-up" style="font-size:30px"></i>
      </h2>
      <communication-area ng-hide="hideCommunications" thread="{{'company-' + company.id}}" members="{{members}}" me="{{me}}" roles="{{roles}}"></communication-area>

      <h2 ng-click="hideComments=!hideComments" title="Click to show/hide comments"> 
        Comments 
        <i ng-show="hideComments" class="fa fa-chevron-circle-down" style="font-size:30px"></i> 
        <i ng-hide="hideComments" class="fa fa-chevron-circle-up" style="font-size:30px"></i>
      </h2>
      <comment-area ng-hide="hideComments" thread="{{'company-' + company.id}}" me="me" members="members"></comment-area>

    </div>
  </div>
</div>
