<div ng-hide="topic.deleted" class="all-100 activity grey column-group gutters" style="background: #ddd; border-radius: 5px;">
  <h1 ng-if="loading">Loading...</h1>

  <div ng-if="!topic.editing">
    <h3><b>[{{topic.kind}}]</b> {{topic.text}}<i ng-if="topic.closed"> [Closed!]</i><i ng-hide="topic.show.duedate"> [{{timeSince(topic.duedate)}}!]</i></h3>

    <div class="column-group horizontal-gutters">
      <div class="all-20 medium-20 small-100 tiny-100">
        <p>
          <a class="ink-button orange" ng-click="topic.editing=!topic.editing"><i class="fa fa-wrench"></i> Edit topic</a>
        </p>
        <p><small>{{timeSince(topic.posted)}}</small></p>
        <p>
          <a href="/#/member/{{topic.author}}">
            <img ng-src="{{'https://graph.facebook.com/'+getMember(topic.author).facebook+'/picture'}}">
            <b style="font-size: 20px; margin-left:12px;"> {{getMember(topic.author).name}}</b>
          </a>
        </p>
      </div>
      <div class="all-80 medium-80 small-100 tiny-100">
        <form ng-if="topic.show.poll" ng-controller="TopicController as tc">
          <div class="control-group">
            <ul class="control unstyled">
              <li ng-repeat="option in topic.poll.options">
                <input type="checkbox" value="true" ng-click="selectOption(topic, option)" ng-checked="option.votes.indexOf(me.id) != -1" ng-disabled="{{topic.closed}}">
                <span ng-if="topic.poll.kind == 'text'">{{option.content}}</span>
                <img ng-if="topic.poll.kind == 'images'" ng-src="{{option.content}}" style="width:30% ">
                <small>{{option.votes.length}} votes</small>
              </li>
            </ul>
          </div>
        </form>
        <div ng-if="topic.targets.length > 0" style="margin-left: 5px;">
          <div class="ink-button blue" ng-click="toggleTargets()"><i class="fa fa-users"></i> {{showTargets ? 'Hide' : 'Show'}} {{topic.targets.length}} targets</div>
          <div ng-if="showTargets" style="margin-left: 5px;">
            <small ng-repeat="target in topic.targets">
              <a href="/#/member/{{target}}" style="margin-right: 10px;">
                {{getMember(target).name}}
              </a>
            </small>
          </div>
        </div>
      </div>
    </div>

    <comment-area thread="{{'topic-' + topic._id}}" ng-if="showComments"></comment-area>
    <div class="ink-button small" ng-click="showComments = !showComments">{{showComments ? 'Hide' : 'Show'}} comments</div>

  </div>



  <div ng-if="topic.editing">
    <h1>{{topic.kind}}</h1>
    <form class="all-100 ink-form">
      <div class="all-100 control-group">
        <label for="text">Text</label>
        <div class="control">
          <textarea id="text" ng-model="topic.text" type="text" rows="3" placeholder="Write your topic contents."></textarea>
        </div>
      </div>

      <div ng-if="topic.show.duedate" class="all-100 control-group">
        <label for="text">Due Date</label>
        <div class="control"><input date-input ng-model="topic.duedate">
        </div>
      </div>

      <div ng-if="topic.show.targets" class="all-100 control-group">
        <div class="all-100">
        <label ng-click="toggleAllTargets()"><a>Targets</a></label><i class="fa fa-long-arrow-left"></i><small> Click to toggle all.</small>
          <div class="all-100">
            <div class="ink-button small green" style="margin-bottom: 0.5em;" ng-click="toggleRoleTargets(role.id)" ng-repeat="role in roles | orderBy:'id'">{{role.name}}</div>
            <br>
            <span ng-click="toggleTarget(member.id)" ng-repeat="member in members | orderBy:'id'">
              <a class="ink-button small blue" ng-show="topic.targets.indexOf(member.id) != -1">{{member.name}}</a>
              <a class="ink-button small" ng-hide="topic.targets.indexOf(member.id) != -1">{{member.name}}</a>
            </span>
          </div>
        </div>
      </div>

      <div ng-if="topic.show.poll" class="all-100 gutters half-bottom-space">
        <label>Poll</label>
        <select ng-model="topic.poll.kind" ng-options="value for value in pollKinds"></select>
        <ul>
          <li ng-repeat="option in topic.poll.options">
            <div ng-if="option.editing">
              <div class="all-100">
                <input type="text" ng-model="option.content">
                <div class="ink-button green" ng-click="focusOption()"><i class="fa fa-check"></i> Save option</div>
                <div class="ink-button red" ng-click="removeOption(option)"><i class="fa fa-times"></i> Remove option</div>
                <p ng-if="topic.poll.kind == pollKinds[1]" style="margin-left: 5px;">
                  <img ng-src="{{option.content}}">
                </p>

              </div>
            </div>

            <div class="all-100" ng-hide="option.editing" ng-click="focusOption(option)">

              <p ng-if="topic.poll.kind == pollKinds[0]" style="margin-left: 5px;">
                {{option.content}}
                <i class="fa fa-wrench ink-button"></i>
              </p>
              <p ng-if="topic.poll.kind == pollKinds[1]" style="margin-left: 5px;">
                <img ng-src="{{option.content}}">
                <i class="fa fa-wrench ink-button"></i>
              </p>
            </div>
          </li>
        </ul>
        <br>
        <div class="all-100">
          <div class="ink-button green" ng-click="addOption()"><i class="fa fa-plus"></i> Add option</div>
        </div>
      </div>

      <div ng-if="topic.show.closed" class="all-100 gutters half-bottom-space">
        <label>Is it done?</label>
        <div class="control-group">
          <ul class="control unstyled">
            <li><input type="checkbox" ng-model="topic.closed" id="close" name="close" value="true"><label for="close">Close</label></li>
          </ul>
        </div>
      </div>

      <div class="all-100 control-group top-space half-bottom-space">
        <a class="ink-button orange" ng-click="topic.editing=!topic.editing"><i class="fa fa-back"></i><i class="fa fa-reply"></i> Go back...</a>
        <a class="ink-button green" ng-click="save(topic)"><i class="fa fa-check"></i> Save</a>
        <a class="ink-button red" ng-click="deleteTopic(topic)"><i class="fa fa-times"></i> Delete</a>
        <div class="ink-alert basic success" ng-if="success">
          <button class="ink-dismiss">&times;</button>
          <p><strong>Success!</strong> {{success}}</p>
        </div>
        <div class="ink-alert basic error" ng-if="error">
          <button class="ink-dismiss">&times;</button>
          <p><strong>Error!</strong> {{error}}</p>
        </div>
      </div>
    </form>
  </div>

</div>
