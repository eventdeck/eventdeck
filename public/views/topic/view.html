<div class="column-group horizontal-gutters">
  <div ng-show="loading" class="all-100">
    <h1>Loading...</h1>
  </div>

  <div ng-hide="loading" class="all-100">
    <div class="column-group horizontal-gutters">
      <div class="all-100">
        <h1>
          [{{topic.kind}}] {{topic.text}}<i ng-show="topic.closed"> [Closed!]</i><i ng-hide="show.duedate"> [{{timeSince(topic.duedate)}}!]</i>
        </h1>
      </div>
    </div>

    <div class="column-group horizontal-gutters">
      <div class="all-20 medium-20 small-100 tiny-100">
        <p>
          <a class="ink-button orange" href="/#/topic/{{topic._id}}/edit"><i class="fa fa-wrench"></i> Edit topic</a>
        </p>
        <p><small>{{timeSince(topic.posted)}}</small></p>
        <p>
          <a href="/#/member/{{topic.author}}">
            <img ng-src="{{'https://graph.facebook.com/'+getMember(topic.author).facebook+'/picture'}}">
            <b style="font-size: 20px; margin-left:12px;"> {{getMember(topic.author).name}}</b>
          </a>
        </p>
      </div>
      <div class="all-80 medium-80 small-100 tiny-100">
        <form ng-show="show.poll" ng-controller="TopicController as tc">
          <div class="control-group">
            <ul class="control unstyled">
              <li ng-repeat="option in topic.poll.options">
                <input type="checkbox" value="true" ng-click="tc.selectOption(topic,option)" ng-checked="option.votes.indexOf(me.id) != -1" ng-disabled="{{topic.closed}}">
                <span ng-if="topic.poll.kind == 'text'">{{option.content}}</span>
                <img ng-if="topic.poll.kind == 'images'" ng-src="{{option.content}}" style="width:30% ">
                <small>{{option.votes.length}} votes</small>
              </li>
            </ul>
          </div>
        </form>
        <div ng-show="topic.targets.length > 0" style="margin-left: 5px;">
          <div class="ink-button blue" ng-click="toggleTargets()"><i class="fa fa-users"></i> {{showTargets ? 'Hide' : 'Show'}} {{topic.targets.length}} targets</div>
          <div ng-show="showTargets" style="margin-left: 5px;">
            <small ng-repeat="target in topic.targets">
              <a href="/#/member/{{target}}" style="margin-right: 10px;">
                {{getMember(target).name}}
              </a>
            </small>
          </div>
        </div>
        <br>
        <div ng-show="topic.notifications">
          <h3>Last Changes</h3>
          <ul>
            <li ng-repeat="notification in topic.notifications | orderBy: 'posted':true | limitTo: 5">{{notification.description}} <small>{{timeSince(notification.posted)}}</small>.</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="column-group horizontal-gutters">
      <div class="all-100">
        <p class="text-center" ng-show="commentsLoading"><span class="fa fa-meh-o fa-5x fa-spin"></span></p>

        <div class="comment" ng-hide="commentsLoading" ng-repeat="comment in comments | orderBy: 'posted':false">
          <div class="column-group horizontal-gutters">
            <div class="all-10">
              <a href="/#/member/{{comment.member}}"><img ng-src="{{'https://graph.facebook.com/' + getMember(comment.member).facebook + '/picture'}}"/></a>
            </div>
            <div class="all-70" >
              <small>{{timeSince(comment.posted)}}</small>
              <div ng-bind-html="convertNewLinesToHtml(comment.html)"></div>
            </div>
            <div class="all-20 align-right">
              <small>
                <a class="ink-button green" ng-click="quoteComment(comment)">Quote</a>
                <a class="ink-button orange" ng-show="comment.member==me.id" href="/#/comment/{{comment._id}}/edit">Edit</a>
                <a class="ink-button red" ng-show="comment.member==me.id" ng-click="deleteComment(comment._id)">Delete</a>
              </small>
            </div>
          </div>
        </div>

        <br>

        <div class="all-45 half-right-space">

          <form class="ink-form" ng-submit="submitComment()">

            <div class="control-group">
              <label for="markdownfield">Your Comment in Markdown</label>
              <a href="https://guides.github.com/features/mastering-markdown/" target="_blank">Help?</a>
              <div class="control">
                <textarea id="markdownfield" ng-model="commentData.markdown" type="text" rows="6" width="90%"></textarea>
              </div>
            </div>
            <div class="control-group">
              <input type="submit" id="submit" value="Post Comment" class="ink-button green" />
              <div ng-show="emptyComment" class="ink-alert basic error">You can't post empty comments.</div>
            </div>
          </form>
        </div>
        <div class="all-45">
          <h6>Preview</h6>
          <div compile="convertMarkdownToHtml(commentData.markdown)"></div>
        </div>

        <div class="all-100">
          <a class="ink-button orange half-vertical-space" href="/#/topics"><i class="fa fa-back"></i><i class="fa fa-reply"></i> Go back...</a>
        </div>
      </div>
    </div>
  </div>
</div>
